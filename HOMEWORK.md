# –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –†–∞–±–æ—Ç–∞ —Å WireMock –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ API –≤ —Ç–µ—Å—Ç–∞—Ö

## –¶–µ–ª—å –∑–∞–¥–∞–Ω–∏—è
–ù–∞—É—á–∏—Ç—å—Å—è –ø–æ–¥–Ω–∏–º–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å WireMock –∫–∞–∫ standalone-—Å–µ—Ä–≤–µ—Ä (–∏–ª–∏ in-memory –≤ —Ç–µ—Å—Ç–∞—Ö), —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—Ç–∞–±—ã (stubs) —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ—Ç–≤–µ—Ç—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞, —É–¥–∞–ª—è—Ç—å —Å—Ç–∞–±—ã –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º. –í—ã —Ç–∞–∫–∂–µ –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç–µ—Å—å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤, —ç–º—É–ª—è—Ü–∏–∏ –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (states) –¥–ª—è –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫ WireMock –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

–ó–∞–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å—Ü–µ–Ω–∞—Ä–∏–∏: —ç–º—É–ª—è—Ü–∏—è API, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–≥–æ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è, –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤) –∏ —Ä–∞—Å—á–µ—Ç —Å–∫–∏–¥–∫–∏ (10% –µ—Å–ª–∏ –∑–∞–∫–∞–∑–æ–≤ ‚â•5, –∏–Ω–∞—á–µ 0%). –®–∞–±–ª–æ–Ω —Ç–µ—Å—Ç–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –≤ —Ñ–∞–π–ª–µ `SaleTest.java` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –∫–∞–∫ –æ—Å–Ω–æ–≤—É, –Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞–π—Ç–µ –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –Ω–∏–∂–µ.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: Java 17+, Maven/Gradle (–¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π), WireMock (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–ª–∏ standalone JAR/Docker), JUnit 5 –∏–ª–∏ TestNG, OkHttp –∏–ª–∏ –¥—Ä—É–≥–æ–π HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤, Jackson –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON.
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã:
- **–ó–∞–ø—É—Å–∫ WireMock**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ in-memory —Ä–µ–∂–∏–º –≤ —Ç–µ—Å—Ç–∞—Ö (—á–µ—Ä–µ–∑ `WireMockServer`) –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã.
- **–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö**: –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å—ã `Client` (—Å –ø–æ–ª—è–º–∏ id, name, surname, birthday, List<Order>) –∏ `Order` (—Å –ø–æ–ª–µ–º id –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º).

## –û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ –∑–∞–¥–∞–Ω–∏—è
–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞–≤—Ç–æ—Ç–µ—Å—Ç –≤ JUnit 5 –∏–ª–∏ TestNG. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞:
- `@BeforeEach` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞–±–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- `@Test` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å–æ —Å—Ç–∞–±–∞–º–∏.
- `@AfterEach` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞–±–æ–≤.

### –®–∞–≥ 1: –ü–æ–¥–Ω—è—Ç—å WireMock –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å—Ç–∞–±
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ WireMock-—Å–µ—Ä–≤–µ—Ä –Ω–∞ localhost:8080 (in-memory: `WireMockServer wireMockServer = new WireMockServer(8080); wireMockServer.start();`).
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Å—Ç–∞–± –¥–ª—è GET-–∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ `/client/123` —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, priority=9999).
- –û—Ç–≤–µ—Ç: JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å fixedDelay=1000 –º—Å –¥–ª—è —ç–º—É–ª—è—Ü–∏–∏ –∑–∞–¥–µ—Ä–∂–∫–∏.
- –ü—Ä–∏–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç–∞–±–∞:
  ```
  wireMockServer.stubFor(get(urlEqualTo("/client/123"))
      .atPriority(9999)
      .willReturn(aResponse()
          .withStatus(200)
          .withHeader("Content-Type", "application/json")
          .withBody(objectMapper.writeValueAsString(new Client(123, "Ivan", "Ivanov", "10-10-1990", List.of(/* 6 orders */))))
          .withFixedDelay(1000)));
  ```
- –í —Ç–µ—Å—Ç–µ: –°–¥–µ–ª–∞–π—Ç–µ GET-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/client/123`, –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–π—Ç–µ –æ—Ç–≤–µ—Ç –≤ `Client`, —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∏ —Å–∫–∏–¥–∫—É.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫–∏–¥–∫–∞ = 10%.
- –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: System.out.println("–î–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å—Ç–∞–± –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –°–∫–∏–¥–∫–∞: " + discount);

### –®–∞–≥ 2: –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∞–± —Å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
- –í —Ç–µ—Å—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π —Å—Ç–∞–± –Ω–∞ —Ç–æ—Ç –∂–µ URL (`/client/123`) —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º (priority=1).
- –û—Ç–≤–µ—Ç: –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ —Å 1 –∑–∞–∫–∞–∑–æ–º (orders ‚Äî —Å–ø–∏—Å–æ–∫ –∏–∑ 1 —ç–ª–µ–º–µ–Ω—Ç–∞).
- –ü—Ä–∏–º–µ—Ä:
  ```
  StubMapping overrideStub = wireMockServer.stubFor(get(urlEqualTo("/client/123"))
      .atPriority(1)
      .willReturn(aResponse()
          .withStatus(200)
          .withHeader("Content-Type", "application/json")
          .withBody(objectMapper.writeValueAsString(new Client(123, "Ivan", "Ivanov", "10-10-1990", List.of(/* 1 order */))))));
  ```
- –°–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å, —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å–∫–∏–¥–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫–∏–¥–∫–∞ = 0%.
- –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: System.out.println("–°—Ç–∞–± –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω. –°–∫–∏–¥–∫–∞: " + discount);

### –®–∞–≥ 3: –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–± –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –∫ –¥–µ—Ñ–æ–ª—Ç—É
- –£–¥–∞–ª–∏—Ç–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–±: `wireMockServer.removeStub(overrideStub);`.
- –°–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∑–∞–Ω–æ–≤–æ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫–∏–¥–∫–∞ —Å–Ω–æ–≤–∞ = 10%.
- –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: System.out.println("–°—Ç–∞–± —É–¥–∞–ª–µ–Ω. –°–∫–∏–¥–∫–∞: " + discount);

### –®–∞–≥ 4: –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞
- –í `@AfterEach`: –û—á–∏—Å—Ç–∏—Ç–µ –≤—Å–µ —Å—Ç–∞–±—ã (`wireMockServer.resetAll();`) –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (`wireMockServer.stop();`), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≤–ª–∏—è–Ω–∏—è –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–¥–ª—è —É–≥–ª—É–±–ª–µ–Ω–∏—è)
- **–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏**: –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è:
    - 0 –∑–∞–∫–∞–∑–æ–≤ (orders = –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫) ‚Äî —Å–∫–∏–¥–∫–∞ 0%.
    - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è orders (null) ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –∫–∞–∫ 0 –∑–∞–∫–∞–∑–æ–≤.
    - –û—à–∏–±–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç (—Å—Ç–∞–± —Å status=404 –∏–ª–∏ 500) ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ –∫–æ–¥–µ.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–µ—Ä–∂–∫–∏**: –ó–∞–º–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ (System.currentTimeMillis() –¥–æ/–ø–æ—Å–ª–µ) –∏ assert, —á—Ç–æ –æ–Ω–æ >=1000 –º—Å.
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤**: –°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–µ—Ç–∏–π —Å—Ç–∞–± —Å priority=5000 (–º–µ–∂–¥—É 1 –∏ 9999) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç).
- **–°—Ü–µ–Ω–∞—Ä–∏–∏ (states)**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π, –≥–¥–µ –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 6 –∑–∞–∫–∞–∑–æ–≤ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ "INITIAL"), –≤—Ç–æ—Ä–æ–π ‚Äî 1 –∑–∞–∫–∞–∑ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ "UPDATED" –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `inScenario("ClientDiscount") .whenScenarioStateIs("INITIAL")` –∏ —Ç.–¥.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞**: –î–æ–±–∞–≤—å—Ç–µ –≤—ã–≤–æ–¥ unmatched requests (`wireMockServer.findUnmatchedRequests()`) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–æ–∫ –º–∞—Ç—á–∏–Ω–≥–∞.

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —Å–¥–∞—á–∏
- –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ (–≤—Å–µ assert —É—Å–ø–µ—à–Ω—ã).
- –ö–æ–¥ —á–∏—Ç–∞–µ–º—ã–π, —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∫ —à–∞–≥–∞–º.
- –û—Ç—á–µ—Ç: –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Ç–µ—Å—Ç–∞ (–≤–µ—Ç–∫–∞ –≤ GitHub —Å –≤–∞—à–µ–π —Ñ–∞–º–∏–ª–∏–µ–π).
- –°—Ä–æ–∫: –¥–æ 8.10 10:00. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, —á—Ç–æ –≤–µ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –Ω–∞ chernyanovskiydv@nspk.ru —Å —Ç–µ–º–æ–π SDET Advanced.

–≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –æ—Å–≤–æ–∏—Ç—å WireMock –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –≤ —á–∞—Ç–µ! –£–¥–∞—á–∏! üöÄ